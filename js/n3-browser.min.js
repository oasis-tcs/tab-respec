/** @license MIT - N3.js library (browser version) - Â©Ruben Verborgh */
!function(e){function t(e,t){for(var r in f)t?e.prototype[r]=i(f[r]):e[r]=f[r];return e}function i(e){return function(t){return e(this,t)}}function r(){if(!(this instanceof r))return new r;for(var e in d)this[e]=d[e]}function s(e){if(!(this instanceof s))return new s(e);if(e=e||{},this._lexer=e.lexer||new r,this._blankNodes=Object.create(null),this._blankNodeCount=0,this._tripleStack=[],e.documentURI){if(e.documentURI.indexOf("#")>0)throw new Error("Invalid document URI");this._baseURI=e.documentURI,this._baseURIPath=this._baseURI.replace(y,""),this._baseURIRoot=this._baseURI.match(g)[0]}else this._baseURI=null,this._baseURIPath=null}function n(e,t){return this instanceof n?(e&&"function"!=typeof e.write&&(t=e,e=null),e||(e=this,this._output="",this.write=function(e,t,i){this._output+=e,i&&i()}),this._outputStream=e,this._prefixURIs=Object.create(null),void(t&&this.addPrefixes(t))):new n(e,t)}function u(e,t){return this instanceof u?(this._size=0,this._contexts=Object.create(null),this._entities=Object.create(null),this._entities[">>____unused_item_to_make_first_entity_key_non-falsy____<<"]=0,this._entityCount=0,this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),this._prefixes=Object.create(null),e&&this.addTriples(e),void(t&&this.addPrefixes(t))):new u(e,t)}var a="http://www.w3.org/2001/XMLSchema#string",c="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",f={isUri:function(e){if(!e)return e;var t=e[0];return'"'!==t&&"_"!==t},isLiteral:function(e){return e&&'"'===e[0]},isBlank:function(e){return e&&"_:"===e.substr(0,2)},getLiteralValue:function(e){var t=/^"([^]*)"/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]},getLiteralType:function(e){var t=/^"[^]*"(?:\^\^(.+)|(@)[\-a-z]+)?$/i.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]||(t[2]?c:a)},getLiteralLanguage:function(e){var t=/^"[^]*"(?:@([\-a-z]+)|\^\^.+)?$/i.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]?t[1].toLowerCase():""},isPrefixedName:function(e){return e&&/^[^:\/"']*:[^:\/"']+$/.test(e)},expandPrefixedName:function(e,t){var i=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]/.exec(e);if(!i)return e;var r=i[1],s=t[r],n=i.index;if(void 0===s)throw new Error("Unknown prefix: "+r);return 0===n?s+e.substr(r.length+1):e.substr(0,n+3)+s+e.substr(n+r.length+4)}};e.Util=t(t);var d={_iri:/^<((?:[^\x00-\x20<>\\"\{\}\|\^\`]|\\[uU])*)>/,_string:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\.\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=\s|<)/,_prefixedName:/^((?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\.\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=[\s#;,)\]]|\.[\s#\(\[<"'])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d+\.\d+|\.\d+|\d+)(?=[\s#.;,)\]])/,_boolean:/^(?:true|false)(?=[\s#.;,)\]])/,_dot:/^\.(?!\d)/,_punctuation:/^[;,\[\]\(\)]/,_fastString:/^"[^"\\]+"(?=[^"\\])/,_keyword:/^@[a-z]+(?=\s)/,_sparqlKeyword:/^(?:PREFIX|BASE)(?=\s)/i,_type:/^\^\^(?:<([^>]*)>|([A-Z_a-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c-\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd][\-0-9A-Z_a-z\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]*)?:([A-Z_a-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c-\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd][\-0-9A-Z_a-z\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]*)(?=[\s\.;,)#]))/,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_nonwhitespace:/^\S*/,_endOfFile:/^(?:#[^\n\r]*)?$/},o=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,l={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},h=/[\x00-\x20<>\\"\{\}\|\^\`]/,_=String.fromCharCode,p={".":"dot",";":"semicolon",",":"comma","[":"bracketopen","]":"bracketclose","(":"liststart",")":"listend"},b="function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)};r.prototype={_tokenizeToEnd:function(e,t){function i(t){c=t._nonwhitespace.exec(r),t._input=null,e(new Error('Syntax error: unexpected "'+c[0]+'" on line '+t._line+"."))}for(var r=this._input;;){for(var s;s=this._newline.exec(r);)r=r.substr(s[0].length,r.length),this._line++;(s=this._whitespace.exec(r))&&(r=r.substr(s[0].length,r.length));var n={line:this._line,type:"",value:"",prefix:""};if(this._endOfFile.test(r))return t&&(r=null,n.type="eof",e(null,n)),this._input=r;var u,a=r[0],c=null,f=!1;switch(a){case"<":if(c=this._iri.exec(r)){if(u=this._unescape(c[1]),null===u||h.test(u))return i(this);n.type="IRI",n.value=u}break;case'"':case"'":if(c=this._fastString.exec(r))n.type="literal",n.value=c[0];else if(c=this._string.exec(r)){if(u=this._unescape(c[0]),null===u)return i(this);n.type="literal",n.value=u.replace(/^'|'$/g,'"')}else if(c=this._tripleQuotedString.exec(r)){if(u=c[1]||c[2],this._line+=u.split(/\r\n|\r|\n/).length-1,u=this._unescape(u),null===u)return i(this);n.type="literal",n.value=u.replace(/^'|'$/g,'"')}break;case"@":"literal"===this._prevTokenType&&(c=this._langcode.exec(r))?(n.type="langcode",n.value=c[1]):(c=this._keyword.exec(r))&&(n.type=c[0]);break;case"^":(c=this._type.exec(r))&&(n.type="type",c[2]?(n.prefix=c[2],n.value=c[3]):n.value=c[1]);break;case".":if(c=this._dot.test(r)){n.type="dot",c=["."];break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(c=this._number.exec(r))&&(n.type="literal",n.value='"'+c[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(c[1]?"double":/^[+\-]?\d+$/.test(c[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":(c=this._sparqlKeyword.exec(r))?n.type=c[0].toUpperCase():f=!0;break;case"f":case"t":(c=this._boolean.exec(r))?(n.type="literal",n.value='"'+c[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):f=!0;break;case"a":(c=this._shortPredicates.exec(r))?(n.type="abbreviation",n.value="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):f=!0;break;case",":case";":case"[":case"]":case"(":case")":c=this._punctuation.exec(a),n.type=p[a];break;default:f=!0}if(f&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(c=this._prefix.exec(r))?((c=this._prefixedName.exec(r))||t&&(c=this._prefixedName.exec(r+" ")))&&(n.type="prefixed",n.prefix=c[1]||"",n.value=this._unescape(c[2])):(n.type="prefix",n.value=c[1]||"")),null===c)return t||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?i(this):this._input=r;e(null,n),this._prevTokenType=n.type,r=r.substr(c[0].length,r.length)}},_unescape:function(e){try{return e.replace(o,function(e,t,i,r){var s;if(t){if(s=parseInt(t,16),isNaN(s))throw new Error;return _(s)}if(i){if(s=parseInt(i,16),isNaN(s))throw new Error;return 65535>s?_(s):_(55296+((s-=65536)>>10),56320+(1023&s))}var n=l[r];if(!n)throw new Error;return n})}catch(t){return null}},tokenize:function(e,t){function i(e){null!==s._input&&(s._input+=e,s._tokenizeToEnd(t,!1))}function r(){null!==s._input&&s._tokenizeToEnd(t,!0)}var s=this;this._line=1,"string"==typeof e?(this._input=e,b(function(){s._tokenizeToEnd(t,!0)})):(this._input="",e&&"function"!=typeof e?("function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",i),e.on("end",r)):(this.addChunk=i,this.end=r,t||(t=e)))}},e.Lexer=r;var x,r=r,v="http://www.w3.org/1999/02/22-rdf-syntax-ns#",j=v+"nil",w=v+"first",k=v+"rest",I=/:/,y=/[^\/]*$/,g=/^(?:[^:]+:\/*)?[^\/]*/,R=function(){};s.prototype={_readInTopContext:function(e){switch(e.type){case"eof":return this._callback(null,null,this._prefixes);case"@prefix":return this._sparqlStyle=!1,this._readPrefix;case"PREFIX":return this._sparqlStyle=!0,this._readPrefix;case"@base":return this._sparqlStyle=!1,this._readBaseURI;case"BASE":return this._sparqlStyle=!0,this._readBaseURI;default:return this._readSubject(e)}},_readSubject:function(e){switch(e.type){case"IRI":this._subject=null===this._baseURI||I.test(e.value)?e.value:this._resolveURI(e.value);break;case"prefixed":if("_"===e.prefix)this._subject=this._blankNodes[e.value]||(this._blankNodes[e.value]="_:b"+this._blankNodeCount++);else{var t=this._prefixes[e.prefix];if(t===x)return this._error('Undefined prefix "'+e.prefix+':"',e);this._subject=t+e.value}break;case"bracketopen":return this._subject="_:b"+this._blankNodeCount++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case"liststart":return this._tripleStack.push({subject:j,predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;default:return this._error("Expected subject but got "+e.type,e)}return this._subjectHasPredicate=!1,this._readPredicate},_readPredicate:function(e){switch(e.type){case"IRI":case"abbreviation":this._predicate=null===this._baseURI||I.test(e.value)?e.value:this._resolveURI(e.value);break;case"prefixed":if("_"===e.prefix)return this._error("Disallowed blank node as predicate",e);var t=this._prefixes[e.prefix];if(t===x)return this._error('Undefined prefix "'+e.prefix+':"',e);this._predicate=t+e.value;break;case"bracketclose":return this._readBlankNodeTail(e,!0);case"dot":return this._subjectHasPredicate?this._readPunctuation(e,!0):this._error("Unexpected dot",e);case"semicolon":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',e)}return this._subjectHasPredicate=!0,this._readObject},_readObject:function(e){switch(e.type){case"IRI":this._object=null===this._baseURI||I.test(e.value)?e.value:this._resolveURI(e.value);break;case"prefixed":if("_"===e.prefix)this._object=this._blankNodes[e.value]||(this._blankNodes[e.value]="_:b"+this._blankNodeCount++);else{var t=this._prefixes[e.prefix];if(t===x)return this._error('Undefined prefix "'+e.prefix+':"',e);this._object=t+e.value}break;case"literal":return this._object=e.value,this._readDataTypeOrLang;case"bracketopen":var i="_:b"+this._blankNodeCount++;return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:i,type:"blank"}),this._subject=i,this._readBlankNodeHead;case"liststart":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:j,type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',e)}return this._getTripleEndReader()},_readBlankNodeHead:function(e){return"bracketclose"===e.type?this._readBlankNodeTail(e,!0):this._readPredicate(e)},_readBlankNodeTail:function(e,t){if("bracketclose"!==e.type)return this._readPunctuation(e);t!==!0&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,context:"n3/contexts#default"});var i=this._tripleStack.pop();return this._subject=i.subject,null!==i.object?(this._predicate=i.predicate,this._object=i.object,this._getTripleEndReader()):this._readPredicate},_readDataTypeOrLang:function(e){switch(e.type){case"type":var t;if(""===e.prefix)t=e.value;else{var i=this._prefixes[e.prefix];if(i===x)return this._error('Undefined prefix "'+e.prefix+':"',e);t=i+e.value}return this._object+="^^"+t,this._getTripleEndReader();case"langcode":return this._object+="@"+e.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,e)}},_readListItem:function(e){var t=null,i=null,r=this._subject,s=this._tripleStack,n=s[s.length-1],u=this._readListItem;switch(e.type){case"IRI":t=e.value;break;case"prefixed":if("_"===e.prefix)t=this._blankNodes[e.value]||(this._blankNodes[e.value]="_:b"+this._blankNodeCount++);else{var a=this._prefixes[e.prefix];if(a===x)return this._error('Undefined prefix "'+e.prefix+':"',e);t=a+e.value}break;case"literal":t=e.value,u=this._readDataTypeOrLang;break;case"bracketopen":i="_:b"+this._blankNodeCount++,t="_:b"+this._blankNodeCount++,s.push({subject:i,predicate:w,object:t,type:"blank"}),this._subject=t,u=this._readBlankNodeHead;break;case"liststart":i="_:b"+this._blankNodeCount++,s.push({subject:i,predicate:w,object:j,type:"list"}),this._subject=null,u=this._readListItem;break;case"listend":if(s.pop(),0!==s.length&&"list"===s[s.length-1].type&&this._callback(null,{subject:n.subject,predicate:n.predicate,object:n.object,context:"n3/contexts#default"}),this._subject=n.subject,null===n.predicate){if(u=this._readPredicate,n.subject===j)return u}else if(this._predicate=n.predicate,this._object=n.object,u=this._getTripleEndReader(),n.object===j)return u;i=j;break;default:return this._error('Expected list item instead of "'+e.type+'"',e)}return null===i&&(this._subject=i="_:b"+this._blankNodeCount++),null===r?n.object===j?n.object=i:n.subject=i:this._callback(null,{subject:r,predicate:k,object:i,context:"n3/contexts#default"}),null!==t&&this._callback(null,{subject:i,predicate:w,object:t,context:"n3/contexts#default"}),u},_readPunctuation:function(e,t){var i;switch(e.type){case"dot":i=this._readInTopContext;break;case"semicolon":i=this._readPredicate;break;case"comma":i=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return t||this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,context:"n3/contexts#default"}),i},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixURI)},_readPrefixURI:function(e){if("IRI"!==e.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',e);var t;return t=null===this._baseURI||I.test(e.value)?e.value:this._resolveURI(e.value),this._prefixes[this._prefix]=t,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation},_readBaseURI:function(e){return"IRI"!==e.type?this._error("Expected IRI to follow base declaration",e):e.value.indexOf("#")>0?this._error("Invalid base URI",e):(this._baseURI=null===this._baseURI||I.test(e.value)?e.value:this._resolveURI(e.value),this._baseURIPath=this._baseURI.replace(y,""),this._baseURIRoot=this._baseURI.match(g)[0],this._readDeclarationPunctuation)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?this._readInTopContext(e):"dot"!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_getTripleEndReader:function(){var e=this._tripleStack;if(0===e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(e,t){this._callback(new Error(e+" at line "+t.line+"."))},_resolveURI:function(e){switch(e[0]){case void 0:return this._baseURI;case"#":return this._baseURI+e;case"?":return this._baseURI.replace(/(?:\?.*)?$/,e);case"/":return this._baseURIRoot+e;default:return this._baseURIPath+e}},parse:function(e,t,i){this._readCallback=this._readInTopContext,this._prefixes={},"function"==typeof e&&(i=t,t=e,e=null),this._callback=t||R,this._prefixCallback=i||R;var r=this;this._lexer.tokenize(e,function(e,t){r._readCallback!==x&&(null!==e?r._callback(e):r._readCallback=r._readCallback(t))}),e||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}},e.Parser=s;var U=/^"((?:.|\n|\r)*)"(?:\^\^(.+)|@([\-a-z]+))?$/i,v="http://www.w3.org/1999/02/22-rdf-syntax-ns#",m=v+"type",P=/["\\\t\n\r\b\f]/,T=/["\\\t\n\r\b\f]/g,N={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};n.prototype={_write:function(){for(var e=0,t=arguments.length-2;t>=e;e++)this._outputStream.write(arguments[e],"utf8",e===t?arguments[t+1]:null)},_writeUriOrBlankNode:function(e,t){if(/^_:/.test(e))return this._write(e,t);var i,r=e.match(/^(.*[#\/])([a-z][\-_a-z0-9]*)$/i);return r&&(i=this._prefixURIs[r[1]])?this._write(i,r[2],t):void this._write("<",e,">",t)},_writeLiteral:function(e,t,i,r){P.test(e)&&(e=e.replace(T,function(e){return N[e]})),this._write('"',e,'"',t||i?null:r),t?(this._write("^^",null),this._writeUriOrBlankNode(t,r)):i&&this._write("@",i,r)},_writeSubject:function(e,t){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);this._writeUriOrBlankNode(e,t)},_writePredicate:function(e,t){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);e===m?this._write("a",t):this._writeUriOrBlankNode(e,t)},_writeObject:function(e,t){var i=U.exec(e);null!==i?this._writeLiteral(i[1],i[2],i[3],t):this._writeUriOrBlankNode(e,t)},addTriple:function(e,t,i,r){i||(r=t,i=e.object,t=e.predicate,e=e.subject);try{this._prevSubject===e?this._prevPredicate===t?this._write(", ",null):(this._write(";\n    ",null),this._writePredicate(t),this._write(" ",null),this._prevPredicate=t):(this._prevSubject&&this._write(".\n",null),this._writeSubject(e),this._write(" ",null),this._writePredicate(t),this._write(" ",null),this._prevSubject=e,this._prevPredicate=t),this._writeObject(i,r)}catch(s){r&&r(s)}},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,i){/[#\/]$/.test(t)&&(this._prefixURIs[t]=e+":",this._write("@prefix ",e,": <",t,">.\n",i))},addPrefixes:function(e,t){for(var i in e)this.addPrefix(i,e[i]);this._write("\n",t)},end:function(e){if(this._prevSubject&&(this._write(".\n",null),delete this._prevSubject),this===this._outputStream)return e&&e(null,this._output);var t=e&&function(){t=null,e()};try{this._outputStream.end(t)}catch(i){t&&t()}}},e.Writer=n;var E=f.expandPrefixedName;u.prototype={get defaultContext(){return"n3/contexts#default"},get size(){var e=this._size;if(null!==e)return e;var t,i,r=this._contexts;for(var s in r)for(var n in t=r[s].subjects)for(var u in i=t[n])e+=Object.keys(i[u]).length;return this._size=e},_addToIndex:function(e,t,i,r){var s=e[t]||(e[t]={}),n=s[i]||(s[i]={});n[r]=null},_removeFromIndex:function(e,t,i,r){var s,n=e[t],u=n[i];delete u[r];for(s in u)return;delete n[i];for(s in n)return;delete e[t]},_findInIndex:function(e,t,i,r,s,n,u,a){var c,f,d,o=[],l=Object.keys(this._entities);t&&((c=e,e={})[t]=c[t]);for(var h in e){var _=l[h];if(f=e[h]){i&&((c=f,f={})[i]=c[i]);for(var p in f){var b=l[p];if(d=f[p])for(var x=(r?r in d?[r]:[]:Object.keys(d)),v=x.length-1;v>=0;v--){var j={context:a};j[s]=_,j[n]=b,j[u]=l[x[v]],o.push(j)}}}}return o},_countInIndex:function(e,t,i,r){var s,n,u,a=0;t&&((s=e,e={})[t]=s[t]);for(var c in e)if(n=e[c]){i&&((s=n,n={})[i]=s[i]);for(var f in n)(u=n[f])&&(r?r in u&&a++:a+=Object.keys(u).length)}return a},addTriple:function(e,t,i,r){t||(r=e.context,i=e.object,t=e.predicate,e=e.subject),r=r||this.defaultContext;var s=this._contexts[r];s||(s=this._contexts[r]={subjects:{},predicates:{},objects:{}},Object.freeze(s));var n=this._entities;e=n[e]||(n[e]=++this._entityCount),t=n[t]||(n[t]=++this._entityCount),i=n[i]||(n[i]=++this._entityCount),this._addToIndex(s.subjects,e,t,i),this._addToIndex(s.predicates,t,i,e),this._addToIndex(s.objects,i,e,t),this._size=null},addTriples:function(e){for(var t=e.length-1;t>=0;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,i,r){t||(r=e.context,i=e.object,t=e.predicate,e=e.subject),r=r||this.defaultContext;var s,n=this._entities,u=this._contexts;if((e=n[e])&&(t=n[t])&&(i=n[i])&&(s=u[r])){var a,c;if((a=s.subjects[e])&&(c=a[t])&&i in c){this._removeFromIndex(s.subjects,e,t,i),this._removeFromIndex(s.predicates,t,i,e),this._removeFromIndex(s.objects,i,e,t),null!==this._size&&this._size--;for(e in s.subjects)return;delete u[r]}}},removeTriples:function(e){for(var t=e.length-1;t>=0;t--)this.removeTriple(e[t])},find:function(e,t,i,r){var s=this._prefixes;return this.findByUri(E(e,s),E(t,s),E(i,s),E(r,s))},findByUri:function(e,t,i,r){r=r||this.defaultContext;var s=this._contexts[r],n=this._entities;return s?e&&!(e=n[e])?[]:t&&!(t=n[t])?[]:i&&!(i=n[i])?[]:e?i?this._findInIndex(s.objects,i,e,t,"object","subject","predicate",r):this._findInIndex(s.subjects,e,t,i,"subject","predicate","object",r):t?this._findInIndex(s.predicates,t,i,e,"predicate","object","subject",r):this._findInIndex(s.objects,i,e,t,"object","subject","predicate",r):[]},count:function(e,t,i,r){var s=this._prefixes;return this.countByUri(E(e,s),E(t,s),E(i,s),E(r,s))},countByUri:function(e,t,i,r){r=r||this.defaultContext;var s=this._contexts[r],n=this._entities;return s?e&&!(e=n[e])?0:t&&!(t=n[t])?0:i&&!(i=n[i])?0:e?i?this._countInIndex(s.objects,i,e,t):this._countInIndex(s.subjects,e,t,i):t?this._countInIndex(s.predicates,t,i,e):this._countInIndex(s.objects,i,e,t):0},createBlankNode:function(e){var t;if(e){t=e="_:"+e;for(var i=1;this._entities[t];)t=e+i++}else do t="_:b"+this._blankNodeIndex++;while(this._entities[t]);return this._entities[t]=this._entityCount++,t}},e.Store=u}("undefined"!=typeof exports?exports:this.N3={});